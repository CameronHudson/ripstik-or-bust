(* ::Package:: *)

SetDirectory["C:\\Users\\Andrew\\Documents\\ripstik-or-bust"]
DirectoryStack[]
EulerLagrange = << "EulerLagrangeFileWVals.m"
ResetDirectory[]
Needs["VariationalMethods`"]


ForcedLHS1 = EulerLagrange[[1]][[1]] + f[t]
ForcedEulerLagrange = EulerLagrange;
ForcedEulerLagrange[[1]][[1]] = ForcedLHS1

LinEulerLagrange = ForcedEulerLagrange /.  {Sin[\[Alpha][t]] -> t, Cos[\[Alpha][t]] -> 1, 
									  Sin[\[Theta][t]] -> t, Cos[\[Theta][t]] -> 1,
									  Sin[\[Psi][t]] -> t, Cos[\[Psi][t]] -> 1,
									  Sin[\[Theta]FC[t]] -> t, Cos[\[Theta]FC[t]] -> 1,
									  Sin[\[Theta]BC[t]] -> t, Cos[\[Theta]BC[t]] -> 1,
									  Sin[\[Alpha]FP[t]] -> t, Cos[\[Alpha]FP[t]] -> 1,
									  Sin[\[Alpha]BP[t]] -> t, Cos[\[Alpha]BP[t]] -> 1,  
									  Sin[2\[Alpha][t]] -> 2t, Cos[2\[Alpha][t]] -> 1-t^2, 
									  Sin[2\[Theta][t]] -> 2t, Cos[2\[Theta][t]] -> 1-t^2,
									  Sin[2\[Psi][t]] -> 2t, Cos[2\[Psi][t]] -> 1-t^2,
									  Sin[2\[Theta]FC[t]] -> 2t, Cos[2\[Theta]FC[t]] -> 1-t^2,
									  Sin[2\[Theta]BC[t]] -> 2t, Cos[2\[Theta]BC[t]] -> 1-t^2,
									  Sin[2\[Alpha]FP[t]] -> 2t, Cos[2\[Alpha]FP[t]] -> 1-t^2,
									  Sin[2\[Alpha]BP[t]] -> 2t, Cos[2\[Alpha]BP[t]] -> 1-t^2,
									  Cos[2(\[Theta][t]+\[Psi][t])]-> (1-t^2)*(1-t^2)-4t^2, Cos[2(\[Theta][t]-\[Psi][t])]->(1-t^2)(1-t^2)+4t^2}



model = StateSpaceModel[ForcedEulerLagrange, {{X[t], 0}, {X'[t], 0},
											  {Y[t], 0}, {Y'[t], 0},
											  {Z[t], 0}, {Z'[t], 0},
											  {\[Alpha][t], 0}, {\[Alpha]'[t], 0},
											  {\[Theta][t], 0}, {\[Theta]'[t], 0},
											  {\[Psi][t], 0}, {\[Psi]'[t], 0},
											  {\[Alpha]FP[t], 0}, {\[Alpha]FP'[t], 0},
											  {\[Alpha]BP[t], 0}, {\[Alpha]BP'[t], 0},
											  {\[Theta]FC[t], 0}, {\[Theta]FC'[t], 0},
											  {\[Theta]BC[t], 0}, {\[Theta]BC'[t], 0}}, f[t], {}, t]
gains = LQRegulatorGains[N[model],{DiagonalMatrix[{0, 0, 0, 0, 0, 0, 100, 30, 0, 30, 0, 30, 50, 30, 50, 30, 10, 30, 10, 30}], {{1}}}, Method ->{"Riccati"->{Method-> "Newton"}}]//First


(* ::InheritFromParent:: *)
(*StateSpaceModel[{{{0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,-(2943/144280),0,0,0,0,0,0,0,0,0},{0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,-((981 (-(2865709793/3072000000000000000000)+91338371623/(40000000000000000000000 Sqrt[3])-(91694082957 Sqrt[3])/80000000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)))-(981 (-(2762148257/3072000000000000000000)-743151118367/(160000000000000000000000 Sqrt[3])+(190174309039 Sqrt[3])/160000000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)),0,0,0,0,0,-((981 (-(2865709793/3072000000000000000000)+91338371623/(40000000000000000000000 Sqrt[3])-(91694082957 Sqrt[3])/80000000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000))),0,-((981 (-(2762148257/3072000000000000000000)-743151118367/(160000000000000000000000 Sqrt[3])+(190174309039 Sqrt[3])/160000000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000))),0,-((981 (-(43957295999/3456000000000000000000)-2575211551/(192000000000000000000 Sqrt[3])+(425376569 Sqrt[3])/256000000000000000000))/(10000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000))),0,-((981 (-(43016927999/3456000000000000000000)-2383913921/(192000000000000000000 Sqrt[3])+(424518209 Sqrt[3])/256000000000000000000))/(10000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000))),0},{0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,-((981 (-(45929889122299/57600000000000000000000)-214252094897/(320000000000000000000 Sqrt[3])-(188273175387 Sqrt[3])/1600000000000000000000))/(2000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)))-(981 (45929889122299/57600000000000000000000+214252094897/(320000000000000000000 Sqrt[3])+(188273175387 Sqrt[3])/1600000000000000000000))/(2000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)),0,0,0,0,0,-((981 (-(45929889122299/57600000000000000000000)-214252094897/(320000000000000000000 Sqrt[3])-(188273175387 Sqrt[3])/1600000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)))-(981 (45929889122299/57600000000000000000000+214252094897/(320000000000000000000 Sqrt[3])+(188273175387 Sqrt[3])/1600000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)),0,-((981 (-(45929889122299/57600000000000000000000)-214252094897/(320000000000000000000 Sqrt[3])-(188273175387 Sqrt[3])/1600000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)))-(981 (45929889122299/57600000000000000000000+214252094897/(320000000000000000000 Sqrt[3])+(188273175387 Sqrt[3])/1600000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)),0,0,0,0,0},{0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,-((981 (-(80514839/15360000000000000000)+1659755819/(160000000000000000000 Sqrt[3])-(373802699 Sqrt[3])/80000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)))-(981 (91098551/15360000000000000000+904864111/(40000000000000000000 Sqrt[3])-(690139773 Sqrt[3])/160000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)),0,0,0,0,0,-((981 (-(80514839/15360000000000000000)+1659755819/(160000000000000000000 Sqrt[3])-(373802699 Sqrt[3])/80000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000))),0,-((981 (91098551/15360000000000000000+904864111/(40000000000000000000 Sqrt[3])-(690139773 Sqrt[3])/160000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000))),0,-((981 (-(2561172581/27648000000000000000)-13889929/(153600000000000000 Sqrt[3])+(2266537 Sqrt[3])/1024000000000000000))/(10000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000))),0,-((981 (1659755819/27648000000000000000+11289511/(153600000000000000 Sqrt[3])-(23100623 Sqrt[3])/1024000000000000000))/(10000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000))),0},{0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,-(14715/7214),0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0},{0,0,0,0,0,0,-((981 (-(45929889122299/57600000000000000000000)-214252094897/(320000000000000000000 Sqrt[3])-(188273175387 Sqrt[3])/1600000000000000000000))/(2000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)))-(981 (45920387451049/57600000000000000000000+212590783721/(320000000000000000000 Sqrt[3])+(190830849847 Sqrt[3])/1600000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000))-(981 (28971835282433/19200000000000000000000+(527264428441 Sqrt[3])/800000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)),0,0,0,0,0,-((981 (-(45929889122299/57600000000000000000000)-214252094897/(320000000000000000000 Sqrt[3])-(188273175387 Sqrt[3])/1600000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)))-(981 (28971835282433/19200000000000000000000+(527264428441 Sqrt[3])/800000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)),0,-((981 (-(45929889122299/57600000000000000000000)-214252094897/(320000000000000000000 Sqrt[3])-(188273175387 Sqrt[3])/1600000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)))-(981 (45920387451049/57600000000000000000000+212590783721/(320000000000000000000 Sqrt[3])+(190830849847 Sqrt[3])/1600000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)),0,-((981 (-(15021229483/23040000000000000000)+230186938709/(320000000000000000000 Sqrt[3])-(174314600653 Sqrt[3])/320000000000000000000))/(10000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000))),0,-((981 (-(15603697/3840000000000000000)+(2296073 Sqrt[3])/640000000000000000))/(10000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000))),0},{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0},{0,0,0,0,0,0,-((981 (-(45929889122299/57600000000000000000000)-217091463233/(320000000000000000000 Sqrt[3])-(183540894827 Sqrt[3])/1600000000000000000000))/(2000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)))-(981 (45920387451049/57600000000000000000000+212590783721/(320000000000000000000 Sqrt[3])+(190830849847 Sqrt[3])/1600000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000))-(981 (28974867922433/19200000000000000000000+(527708638441 Sqrt[3])/800000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)),0,0,0,0,0,-((981 (-(45929889122299/57600000000000000000000)-217091463233/(320000000000000000000 Sqrt[3])-(183540894827 Sqrt[3])/1600000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)))-(981 (45920387451049/57600000000000000000000+212590783721/(320000000000000000000 Sqrt[3])+(190830849847 Sqrt[3])/1600000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)),0,-((981 (-(45929889122299/57600000000000000000000)-217091463233/(320000000000000000000 Sqrt[3])-(183540894827 Sqrt[3])/1600000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)))-(981 (28974867922433/19200000000000000000000+(527708638441 Sqrt[3])/800000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)),0,-((981 (-(21425227/3840000000000000000)-564889/(64000000000000000 Sqrt[3])-(168519 Sqrt[3])/80000000000000000))/(10000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000))),0,-((981 (-(15185027143/23040000000000000000)+220979360899/(320000000000000000000 Sqrt[3])-(170734388883 Sqrt[3])/320000000000000000000))/(10000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000))),0},{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0},{0,0,0,0,0,0,-((981 (-(15021229483/23040000000000000000)+230186938709/(320000000000000000000 Sqrt[3])-(174314600653 Sqrt[3])/320000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)))-(981 (-(21425227/3840000000000000000)-564889/(64000000000000000 Sqrt[3])-(168519 Sqrt[3])/80000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)),0,0,0,0,0,-((981 (-(15021229483/23040000000000000000)+230186938709/(320000000000000000000 Sqrt[3])-(174314600653 Sqrt[3])/320000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000))),0,-((981 (-(21425227/3840000000000000000)-564889/(64000000000000000 Sqrt[3])-(168519 Sqrt[3])/80000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000))),0,-((981 (224354227459/55296000000000000000+1226638159589/(384000000000000000000 Sqrt[3])+(1461194129 Sqrt[3])/128000000000000000000))/(10000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000))),0,-((981 (-(48057827/864000000000000000)+963859/(64000000000000000 Sqrt[3])+(1098931 Sqrt[3])/128000000000000000))/(10000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000))),0},{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},{0,0,0,0,0,0,-((981 (-(15185027143/23040000000000000000)+220979360899/(320000000000000000000 Sqrt[3])-(170734388883 Sqrt[3])/320000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)))-(981 (-(15603697/3840000000000000000)+(2296073 Sqrt[3])/640000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000)),0,0,0,0,0,-((981 (-(15603697/3840000000000000000)+(2296073 Sqrt[3])/640000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000))),0,-((981 (-(15185027143/23040000000000000000)+220979360899/(320000000000000000000 Sqrt[3])-(170734388883 Sqrt[3])/320000000000000000000))/(4000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000))),0,-((981 (-(48057827/864000000000000000)+564889/(64000000000000000 Sqrt[3])+(1364911 Sqrt[3])/128000000000000000))/(10000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000))),0,-((981 (220979360899/55296000000000000000-1554622023821/(384000000000000000000 Sqrt[3])+(298332445619 Sqrt[3])/128000000000000000000))/(10000 (45929889122299/5529600000000000000000000+849199663633/(153600000000000000000000 Sqrt[3])+(87431148557 Sqrt[3])/51200000000000000000000))),0}},{{0},{7229/36070},{0},{0},{0},{0},{0},{0},{0},{0},{0},{150/3607},{0},{0},{0},{0},{0},{0},{0},{0}},{},{}},{{X[t],0},Subscript[\[FormalX], 1],{\[Psi][t],0},Subscript[\[FormalX], 2],{Y[t],0},Subscript[\[FormalX], 3],{\[Alpha][t],0},Subscript[\[FormalX], 4],{\[Alpha]BP[t],0},Subscript[\[FormalX], 5],{\[Alpha]FP[t],0},Subscript[\[FormalX], 6],{\[Theta]BC[t],0},Subscript[\[FormalX], 7],{\[Theta]FC[t],0},Subscript[\[FormalX], 8],{Z[t],0},Subscript[\[FormalX], 9],{\[Theta][t],0},Subscript[\[FormalX], 10]},{{f[t],0}},Automatic,t,SamplingPeriod->None,SystemsModelLabels->None]*)


ControlForce = -gains.{X[t], X'[t],
					   Y[t], Y'[t],
					   Z[t], Z'[t],
					   \[Alpha][t], \[Alpha]'[t],
					   \[Theta][t], \[Theta]'[t],
					   \[Psi][t], \[Psi]'[t],
					   \[Alpha]FP[t], \[Alpha]FP'[t],
					   \[Alpha]BP[t], \[Alpha]BP'[t],
					   \[Theta]FC[t], \[Theta]FC'[t],
					   \[Theta]BC[t], \[Theta]BC'[t]}
